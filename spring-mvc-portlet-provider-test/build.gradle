import aQute.bnd.gradle.Bundle
import aQute.bnd.gradle.Resolve
import aQute.bnd.gradle.TestOSGi

plugins {
    id 'biz.aQute.bnd.builder' version '5.3.0'
}

dependencies {
    testImplementation project(':spring-mvc-portlet-provider')

    testImplementation "com.liferay.lugbot:com.liferay.code.upgrade.providers:1.0.0-SNAPSHOT"
    testImplementation "com.liferay.lugbot:com.liferay.lugbot.api:1.0.0-SNAPSHOT"

    testImplementation "org.apache.commons:commons-compress:1.20"
    testImplementation "org.osgi:org.osgi.test.junit5:0.9.0"


    testRuntimeOnly "biz.aQute.bnd:aQute.libg:5.3.0"
    testRuntimeOnly "biz.aQute.bnd:biz.aQute.bndlib:5.3.0"
    testRuntimeOnly "biz.aQute.bnd:biz.aQute.tester.junit-platform:5.3.0"

    testRuntimeOnly "com.googlecode.javaewah:JavaEWAH:1.1.9"
    testRuntimeOnly "com.google.guava:guava:21.0"


    testRuntimeOnly "commons-configuration:commons-configuration:1.10"

    testRuntimeOnly "commons-logging:commons-logging:1.2"

    testRuntimeOnly "javax.annotation:javax.annotation-api:1.3.2"
    testRuntimeOnly "javax.el:javax.el-api:2.2.5"

    testRuntimeOnly "javax.servlet.jsp:javax.servlet.jsp-api:2.2.1"
    testRuntimeOnly "javax.servlet:javax.servlet-api:3.1.0"

    testRuntimeOnly "org.apache.felix:org.apache.felix.framework:6.0.4"
    testRuntimeOnly "org.apache.felix:org.apache.felix.logback:1.0.2"
    testRuntimeOnly "org.apache.felix:org.apache.felix.metatype:1.2.2"
    testRuntimeOnly "org.apache.felix:org.apache.felix.scr:2.1.20"

    testRuntimeOnly "org.apache.servicemix.bundles:org.apache.servicemix.bundles.junit:4.12_1"

    testRuntimeOnly "org.codehaus.groovy:groovy:2.5.9"

    testRuntimeOnly "org.junit.jupiter:junit-jupiter-api:5.7.1"
    testRuntimeOnly "org.junit.jupiter:junit-jupiter-engine:5.7.1"
    testRuntimeOnly "org.junit.platform:junit-platform-launcher:1.7.1"

    testRuntimeOnly "org.osgi:org.osgi.service.component.annotations:1.4.0"
    testRuntimeOnly "org.osgi:org.osgi.service.component:1.4.0"
    testRuntimeOnly "org.osgi:org.osgi.service.log:1.4.0"
    testRuntimeOnly "org.osgi:org.osgi.service.metatype.annotations:1.4.0"
    testRuntimeOnly "org.osgi:org.osgi.util.function:1.1.0"
    testRuntimeOnly "org.osgi:org.osgi.util.promise:1.1.1"
    testRuntimeOnly "org.osgi:osgi.core:7.0.0"

    testRuntimeOnly "org.tukaani:xz:1.9"

    testRuntimeOnly group: 'org.osgi', name: 'org.osgi.util.pushstream', version: '1.0.1'
    testRuntimeOnly group: 'org.eclipse.birt.runtime.3_7_1', name: 'org.apache.xml.resolver', version: '1.2.0'


}

tasks.named('jar', Jar) {
    archiveClassifier = 'tests'
    from sourceSets.test.output
    sourceSet = sourceSets.test
}

tasks.named('test', Test) {
    // Our JUnit tests run inside the OSGi framework.
    enabled = false
}

def resolveTask = tasks.register('resolve', Resolve) {
    bndrun = file('test.bndrun')
    bundles = files(sourceSets.test.runtimeClasspath, configurations.archives.artifacts.files)
    reportOptional = false
}

def testOSGi = tasks.register('testOSGi', TestOSGi) {
    dependsOn jar, resolve

    bundles = files(sourceSets.test.runtimeClasspath, configurations.archives.artifacts.files)
    bndrun = 'test.bndrun'
}

tasks.named('check') {
    dependsOn testOSGi
}
